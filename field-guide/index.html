<!doctype html><html lang="en"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>White Forest Field Guide</title>
<style>
:root { color-scheme: dark; --fg:#e7e7e7; --bg:#0d0d0f; --muted:#9aa0a6; --accent:#8af; }
*{box-sizing:border-box} body{margin:0;font:16px/1.5 ui-sans-serif,system-ui;background:var(--bg);color:var(--fg)}
a{color:var(--accent);text-decoration:none} a:hover{text-decoration:underline}
.wrapper{max-width:980px;margin:auto;padding:16px}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:12px}
.card{background:#141418;border:1px solid #222;border-radius:12px;overflow:hidden}
.card img{width:100%;display:block}
.card .pad{padding:10px}
.mono{font-family:ui-monospace,Consolas,monospace}
input[type="search"]{width:100%;padding:10px;border-radius:10px;border:1px solid #2a2a30;background:#121216;color:var(--fg);outline:none;margin:8px 0}
.badge{font-size:12px;color:#cde;background:#20304a;padding:4px 8px;border-radius:999px;margin-right:6px}
small{color:var(--muted)}
.btn{display:inline-block;padding:8px 12px;border:1px solid #2a2a30;border-radius:8px}
#debug{white-space:pre-wrap;background:#120f15;border:1px solid #362447;border-radius:8px;padding:8px;margin-top:10px;color:#e6d9ff;display:none}
</style>
</head><body>
<div class="wrapper">
  <a class="btn" href="../index.html">← Micros Hub</a>
  <h1>White Forest Field Guide <small class="mono" id="count"></small></h1>
  <input id="q" type="search" placeholder="Search title, guild, trait…">
  <div id="cards" class="grid" aria-live="polite"></div>
  <pre id="debug" aria-live="polite"></pre>
</div>

<script>
(function(){
  // tiny helpers (inline)
  async function loadJSON(path){
    const r = await fetch(path, {cache:"no-store"});
    if(!r.ok) throw new Error("Failed to load "+path+" ("+r.status+")");
    return r.json();
  }
  const $=(s,r=document)=>r.querySelector(s);
  function h(tag, attrs={}, ...kids){
    const el=document.createElement(tag);
    for(const [k,v] of Object.entries(attrs)) (k==="class")? el.className=v : el.setAttribute(k,v);
    for(const k of kids) el.append(k);
    return el;
  }
  function getQueryParam(name){ return new URLSearchParams(location.search).get(name); }
  function linkToMap(id){ return `../ascii-map/index.html?id=${encodeURIComponent(id)}`; }
  function formatCoords([lat,lon]){ return `${(+lat).toFixed(2)}°, ${(+lon).toFixed(2)}°`; }
  const dbg = $("#debug");
  function logDebug(msg){ dbg.style.display="block"; dbg.textContent += msg+"\n"; console.log(msg); }

  (async function main(){
    try{
      logDebug("Field Guide booting…");
      const dataUrl = "../data/entries.json";
      logDebug("Fetching: "+dataUrl);
      const data = await loadJSON(dataUrl);
      logDebug("Loaded entries: "+data.length);

      const q=$("#q"), cards=$("#cards"), count=$("#count");
      const selectedId = getQueryParam("id");

      function match(entry, term){
        if(!term) return true;
        const hay=(entry.title+" "+entry.guild+" "+(entry.traits||[]).join(" ")+" "+(entry.lore||"")).toLowerCase();
        return hay.includes(term.toLowerCase());
      }

      function render(list){
        cards.replaceChildren();
        list.forEach(e=>{
          const card=h("div",{class:"card",tabindex:"0",role:"article","aria-labelledby":e.id});
          if(e.img) card.append(h("img",{src:e.img,alt:e.title}));
          const pad=h("div",{class:"pad"});
          pad.append(
            h("div",{},
              h("span",{class:"badge"}, e.guild||""),
              h("small",{}, e.coords?formatCoords(e.coords):"")
            ),
            h("h3",{id:e.id}, e.title||"(untitled)"),
            h("p",{}, e.lore||""),
            h("p",{}, h("small",{}, "Traits: "+((e.traits||[]).join(", ")||"—"))),
            h("p",{}, h("a",{href:linkToMap(e.id),class:"btn"},"View on ASCII Map"))
          );
          if(e.id===selectedId) card.style.outline="2px solid var(--accent)";
          card.append(pad);
          cards.append(card);
        });
        count.textContent="("+list.length+")";
      }

      render(data);
      q.addEventListener("input",()=>render(data.filter(e=>match(e,q.value))));
      logDebug("Render complete.");
    }catch(err){
      logDebug("ERROR: "+(err && err.message ? err.message : err));
      logDebug("Tip: open the JSON directly in this tab to confirm: ../data/entries.json");
    }
  })();
})();
</script>
</body></html>
